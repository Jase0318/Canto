<!DOCTYPE html>
<html lang="zh-Hant-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>粵語學習助手 | CantoLearn Pro</title>
    
    <!-- 1. Tailwind CSS (美化介面) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. React & ReactDOM (核心引擎) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- 3. Babel (讓瀏覽器看懂 React) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 4. Segmentit (分詞工具) -->
    <script src="https://unpkg.com/segmentit@2.0.3/dist/umd/segmentit.min.js"></script>
    <!-- 5. Lucide Icons (圖示) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap');
        body { font-family: 'Noto Sans HK', sans-serif; }
        .jyutping { font-family: 'JetBrains Mono', monospace; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ==========================================
        // 1. 內建字典數據 (解決讀取卡住的核心)
        // ==========================================
        // 這裡內建了常用漢字的 LSHK 粵拼，確保打開即用
        const MINI_DICT_STR = "我:ngo5,你:nei5,佢:keoi5,是:si6,係:hai6,好:hou2,食:sik6,去:heoi3,做:zou6,有:jau5,無:mou4,唔:m4,嘅:ge3,咗:zo2,在:zoi6,人:jan4,天:tin1,氣:hei3,熱:jit6,凍:dung3,想:soeng2,愛:oi3,玩:waan2,睇:tai2,聽:teng1,講:gong2,寫:se2,書:syu1,筆:bat1,學:hok6,習:zaap6,粵:jyut6,語:jyu5,廣:gwong2,東:dung1,話:waa2,謝:ze6,多:do1,少:siu2,大:daai6,細:sai3,長:coeng4,短:dyun2,早:zou2,晨:san4,晚:maan5,安:on1,心:sam1,開:hoi1,工:gung1,放:fong3,假:gaa3,巴:baa1,士:si6,地:dei6,鐵:tit3,車:ce1,站:zaam6,路:lou6,邊:bin1,度:dou6,邊:bin1,個:go3,點:dim2,解:gaai2,幾:gei2,時:si4,候:hau6,乜:mat1,嘢:je5,邊:bin1,度:dou6,誰:seoi4,哪:naa5,兒:ji4,爸:baa1,媽:maa1,哥:go1,姐:ze2,妹:mui6,弟:dai6,仔:zai2,女:neoi5,朋:pang4,友:jau5,老:lou5,闆:baan2,師:si1,生:sang1,日:jat6,快:faai3,樂:lok6,祝:zuk1,福:fuk1,健:gin6,康:hong1,平:ping4,錢:cin2,銀:ngan4,行:hong4,買:maai5,賣:maai6,貴:gwai3,平:peng4,靚:leng3,正:zeng3,衰:seoi1,壞:waai6,錯:co3,對:deoi3,真:zan1,假:gaa2,名:ming4,字:zi6,今:gam1,聽:ting1,琴:kam4,昨:zok3,明:ming4,後:hau6,年:nin4,月:jyut6,號:hou6,星:sing1,期:kei4,上:soeng6,下:haa6,左:zo2,右:jau6,前:cin4,後:hau6,裡:leoi5,外:ngoi6,中:zung1,間:gaan1,高:gou1,低:dai1,新:san1,舊:gau6,男:naam4,女:neoi5,水:seoi2,火:fo2,木:muk6,金:gam1,土:tou2,紅:hung4,橙:caang2,黃:wong4,綠:luk6,青:cing1,藍:laam4,紫:zi2,白:baak6,黑:hak1,灰:fui1,一:jat1,二:ji6,三:saam1,四:sei3,五:ng5,六:luk6,七:cat1,八:baat3,九:gau2,十:sap6,百:baak3,千:cin1,萬:maan6,億:jik1,零:ling4,個:go3,隻:zek3,條:tiu4,張:zoeng1,支:zi1,本:bun2,架:gaa3,間:gaan1,部:bou6,粒:lap1,餐:caan1,茶:caa4,水:seoi2,果:gwo2,菜:coi3,肉:juk6,牛:ngau4,豬:zyu1,雞:gai1,魚:jyu4,蛋:daan6,飯:faan6,麵:min6,湯:tong1,糖:tong4,鹽:jim4,油:jau4,醬:zoeng3,醋:cou3,甜:tim4,酸:syun1,苦:fu2,辣:laat6,咸:haam4,香:heong1,臭:cau3,飽:baau2,餓:ngo6,渴:hot3,累:leoi6,攰:gui6,病:beng6,痛:tung3,醫:ji1,院:jyun2,藥:joek6,警:ging2,察:caat3,賊:caak6,偷:tau1,搶:coeng2,打:daa2,殺:saat3,救:gau3,命:meng6,火:fo2,燭:zuk1,電:din6,腦:nou5,手:sau2,機:gei1,上:soeng5,網:mong5,寄:gei3,信:seon3,收:sau1,發:faat3,電:din6,郵:jau4,打:daa2,印:jan3,影:jing2,相:soeng2,拍:paak3,片:pin2,睇:tai2,戲:hei3,唱:coeng3,歌:go1,跳:tiu3,舞:mou5,畫:waa2,公:gung1,司:si1,開:hoi1,會:wui2,報:bou3,告:gou3,計:gai3,劃:waak6,合:hap6,同:tung4,簽:cim1,約:joek3,成:sing4,功:gung1,失:sat1,敗:baai6,試:si3,考:haau2,驗:jim6,難:naan4,易:ji6,問:man6,題:tai4,答:daap3,案:on3,解:gaai2,決:kyut3,幫:bong1,助:zo6,求:kau4,救:gau3,請:cing2,問:man6,唔:m4,該:goi1,借:ze3,過:gwo3,對:deoi3,唔:m4,住:zyu6,沒:mut6,關:gwaan1,係:hai6,再:zoi3,見:gin3,拜:baai1,拜:baai1,喜:hei2,歡:fun1,鍾:zung1,意:ji3,愛:oi3";
        
        const charMap = {};
        MINI_DICT_STR.split(',').forEach(item => {
            const [char, ping] = item.split(':');
            if(char) charMap[char] = ping;
        });

        const getPinyin = (char) => charMap[char] || char;

        // ==========================================
        // 2. React 應用程式
        // ==========================================
        function App() {
            const [input, setInput] = useState("");
            const [result, setResult] = useState([]);
            const [history, setHistory] = useState([]);
            const [filterMode, setFilterMode] = useState(false);
            const [segmentit, setSegmentit] = useState(null);

            // 初始化分詞工具
            useEffect(() => {
                if (window.Segmentit) {
                    setSegmentit(window.Segmentit.useDefault(new window.Segmentit.Segment()));
                }
                const saved = localStorage.getItem('canto_history');
                if(saved) setHistory(JSON.parse(saved));
                
                // 初始化 Lucide Icons
                if(window.lucide) window.lucide.createIcons();
            }, []);

            useEffect(() => {
                if(window.lucide) window.lucide.createIcons();
            }, [result, history]);

            const handleTranslate = () => {
                if(!input.trim()) return;

                let segments = [];
                if (segmentit) {
                    segments = segmentit.doSegment(input).map(s => s.w);
                } else {
                    segments = input.split(/(\s+|[，。！？])/);
                }

                // 過濾邏輯
                const stopWords = ['的', '了', '和', '是', '在', '嗎', '呢', '吧', '啊', '呀', '個', '位'];
                const processed = [];
                
                segments.forEach(word => {
                    const w = word.trim();
                    if(!w || !/[\u4e00-\u9fa5a-zA-Z0-9]/.test(w)) return;
                    
                    if(filterMode && stopWords.includes(w)) return;

                    // 轉拼音 (逐字)
                    const pinyin = w.split('').map(c => getPinyin(c)).join(' ');
                    processed.push({ word: w, ping: pinyin });
                });

                setResult(processed);
                addToHistory(input, processed);
            };

            const addToHistory = (text, res) => {
                const preview = res.map(r => r.ping).join(' ');
                const newEntry = { text, preview, date: new Date().toLocaleString() };
                const newHistory = [newEntry, ...history.filter(h => h.text !== text)].slice(0, 10);
                setHistory(newHistory);
                localStorage.setItem('canto_history', JSON.stringify(newHistory));
            };

            const speak = (text) => {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'zh-HK';
                u.rate = 0.9;
                window.speechSynthesis.speak(u);
            };

            const clearHistory = () => {
                if(confirm('確定清除紀錄？')) {
                    setHistory([]);
                    localStorage.removeItem('canto_history');
                }
            };

            return (
                <div className="max-w-3xl mx-auto px-4 py-8 min-h-screen flex flex-col">
                    <header className="mb-8 text-center">
                        <h1 className="text-3xl font-bold text-teal-700 flex justify-center items-center gap-3">
                            <i data-lucide="languages" className="w-8 h-8"></i>
                            粵語學習助手 <span className="text-xs bg-teal-100 text-teal-800 px-2 py-1 rounded-full">Pro</span>
                        </h1>
                        <p className="text-slate-500 mt-2">LSHK 粵拼標準 • 即時發音</p>
                    </header>

                    <div className="bg-white rounded-2xl shadow-lg p-6 border border-slate-100">
                        <div className="flex justify-between items-center mb-4">
                            <label className="font-bold text-slate-700">輸入中文</label>
                            <label className="flex items-center gap-2 text-sm text-slate-600 cursor-pointer hover:text-teal-600 transition">
                                <input type="checkbox" checked={filterMode} onChange={e => setFilterMode(e.target.checked)} className="rounded text-teal-600 focus:ring-teal-500"/>
                                <span>只顯示重點單詞</span>
                            </label>
                        </div>

                        <textarea 
                            className="w-full h-32 p-4 border border-slate-200 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-transparent outline-none resize-none text-lg transition bg-slate-50 focus:bg-white"
                            placeholder="請輸入文字... 例如：今日天氣好熱"
                            value={input}
                            onChange={e => setInput(e.target.value)}
                        ></textarea>

                        <div className="mt-4 flex justify-end">
                            <button onClick={handleTranslate} className="bg-teal-600 hover:bg-teal-700 text-white px-6 py-2.5 rounded-xl font-medium shadow-md hover:shadow-lg transition-all flex items-center gap-2">
                                <i data-lucide="sparkles" className="w-4 h-4"></i>
                                開始轉換
                            </button>
                        </div>
                    </div>

                    {/* 結果區 */}
                    {result.length > 0 && (
                        <div className="mt-8 animate-fade-in">
                            <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                                <span className="w-1.5 h-6 bg-teal-500 rounded-full"></span> 轉換結果
                            </h2>
                            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                                {result.map((item, idx) => (
                                    <div key={idx} className="bg-white p-4 rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition hover:-translate-y-1 group relative">
                                        <div className="text-2xl font-bold text-slate-800 text-center mb-1">{item.word}</div>
                                        <div className="jyutping text-center text-teal-600 bg-teal-50 py-1 px-2 rounded text-sm font-medium">{item.ping}</div>
                                        <button onClick={() => speak(item.word)} className="absolute top-2 right-2 text-slate-300 hover:text-teal-500 transition">
                                            <i data-lucide="volume-2" className="w-4 h-4"></i>
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* 歷史紀錄 */}
                    <div className="mt-12 pt-8 border-t border-slate-200">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="font-bold text-slate-600 flex items-center gap-2">
                                <i data-lucide="history" className="w-4 h-4"></i> 歷史紀錄
                            </h3>
                            {history.length > 0 && (
                                <button onClick={clearHistory} className="text-xs text-red-400 hover:text-red-600 flex items-center gap-1">
                                    <i data-lucide="trash-2" className="w-3 h-3"></i> 清除
                                </button>
                            )}
                        </div>
                        <div className="space-y-3">
                            {history.length === 0 ? (
                                <p className="text-center text-slate-400 text-sm italic">暫無紀錄</p>
                            ) : history.map((h, i) => (
                                <div key={i} onClick={() => { setInput(h.text); window.scrollTo({top:0, behavior:'smooth'}); }} 
                                    className="bg-white p-4 rounded-lg border border-slate-100 hover:border-teal-200 cursor-pointer transition flex justify-between items-center group">
                                    <div>
                                        <div className="font-medium text-slate-700">{h.text}</div>
                                        <div className="text-xs text-teal-600 mt-1 font-mono opacity-70">{h.preview}</div>
                                    </div>
                                    <div className="text-xs text-slate-300 group-hover:text-slate-400">{h.date}</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <footer className="mt-auto pt-8 text-center text-slate-400 text-xs">
                        © 2025 CantoLearn Pro. Built with React & Tailwind.
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
